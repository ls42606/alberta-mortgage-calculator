var j=(a,d,n)=>new Promise((x,c)=>{var m=s=>{try{i(n.next(s))}catch(o){c(o)}},p=s=>{try{i(n.throw(s))}catch(o){c(o)}},i=s=>s.done?x(s.value):Promise.resolve(s.value).then(m,p);i((n=n.apply(a,d)).next())});import{u as b,j as e}from"./index-CqURk6s4.js";import{r as h}from"./react-vendor-Cmhfrx8h.js";import"./router-vendor-Ca87_sqk.js";import"./ui-vendor-DWiXB900.js";const k=()=>{var u;const[a,d]=h.useState([]),[n,x]=h.useState(!0),[c,m]=h.useState(null),{authState:p,logout:i}=b();h.useEffect(()=>{s()},[]);const s=()=>j(void 0,null,function*(){try{x(!0);const t=yield fetch("/.netlify/functions/leads");if(!t.ok)throw new Error("Failed to fetch leads");const r=yield t.json();d(r.leads||[]),m(null)}catch(t){m("Failed to load leads. They might be stored in localStorage only.");const r=localStorage.getItem("leads");r&&d(JSON.parse(r))}finally{x(!1)}}),o=()=>{const r=[["Name","Email","Phone","Calculator","Message","Date","IP"].join(","),...a.map(l=>[l.name,l.email,l.phone,l.calculatorType||"",(l.message||"").replace(/,/g,";"),new Date(l.timestamp).toLocaleDateString(),l.ip||""].join(","))].join(`
`),N=new Blob([r],{type:"text/csv"}),y=window.URL.createObjectURL(N),g=document.createElement("a");g.href=y,g.download=`leads-${new Date().toISOString().split("T")[0]}.csv`,g.click(),window.URL.revokeObjectURL(y)};return n?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading leads..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Lead Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:["Total leads: ",a.length]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Welcome, ",e.jsx("span",{className:"font-medium",children:(u=p.user)==null?void 0:u.username})]}),e.jsx("button",{onClick:s,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Refresh"}),e.jsx("button",{onClick:o,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:"Export CSV"}),e.jsx("button",{onClick:i,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:"Logout"})]})]}),c&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 m-6",children:e.jsx("div",{className:"flex",children:e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-yellow-700",children:c})})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Calculator Used"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"IP Address"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500",children:"No leads yet. Test the lead capture form to see data here."})}):a.map((t,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.email}),e.jsx("div",{className:"text-sm text-gray-500",children:t.phone})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:t.calculatorType||"General"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:t.message||"No message"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[new Date(t.timestamp).toLocaleDateString()," ",e.jsx("br",{}),new Date(t.timestamp).toLocaleTimeString()]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.ip||"N/A"})]},t.id||r))})]})}),a.length>0&&e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",a.length," lead",a.length!==1?"s":""]})})]})})})};export{k as default};
